import requests

# Let's test whether we can use the same header requests for all GPX files
chunk_size = 4096
gpx_file = "north-table-co.gpx"
referer = "https://www.mtbproject.com/trail/7056184/north-table-figure-8-best-of-the-descents" 
gpx_url = "https://www.mtbproject.com/trail/gpx/7056184" 

# Set the cookies and headers for the request for gpx data
cookies = {
    'photosTitle': 'Nearby%20Photos',
    '_fbp': 'fb.1.1696091992253.102672014',
    'user': 'eyJpdiI6InplYTR1SU1LY2ZsUW9IbW0rdmthQkE9PSIsInZhbHVlIjoiNldIbHZFRmw3Y2drNWN5N2NOcDNtKzBoYS8vRFc5dm51S3N4Q0QvQnluN3lxVFBzdmdhU01VcE5FY0xFNVJGcGsybE1HcGJ6TmNLTE54VEwwM05qMVQ4SWxIVzA2NHgvTWZKRFJnMlF1SHVCb2owUnZodEFPTkxXTGdOSWowYWZMTmVvSnBZd1ZMNGNPOTRhYXhHNy92WnJUYkcxMit0WmhpSXFrcDZBUnBnPSIsIm1hYyI6ImUwMDk3MWZlNDk3ZDE3ODRmZTM3MDhjNzJiMjcxMzJmMGJkNzUwOTQwYTJmYjg5OGFmNDdkYzg2NDFmZWJmOWMiLCJ0YWciOiIifQ%3D%3D',
    'ids': 'eyJpdiI6Im9mbGxHaVJla3lNdlRmaEkwV3lEeGc9PSIsInZhbHVlIjoiVnU3VVY3REhFd0xXVkp1NG9lRTVSQU9xLy9oeVRpNWZENkh3aHFBWjZhY1IzOFZ5aDhyeDRmWWM0RVlLSVZUdVhpSHAvUEtnMGpad3EzQ00zY3VDMEE9PSIsIm1hYyI6ImY1NDc2Y2I2MmQ2MDVmZGVhMmQ2MmNjOWM0OGE3ODEyMTE0Nzk4OGQ4OWU0NzRiZGIwMzQ5YTRhZmIzYjFjMWEiLCJ0YWciOiIifQ%3D%3D',
    '_ga_ZT4D3MZ8J2': 'GS1.1.1698606563.14.1.1698606583.0.0.0',
    'GCLB': 'CJKU7bj9rvOGQw',
    '_ga': 'GA1.1.850084306.1696091991',
    'savedReferrer': 'eyJpdiI6IjlOdldXTHNhMVA5amdSb25wUi9ZMEE9PSIsInZhbHVlIjoiRCtxSzFoZS92QkhXTDU1dHFMRDZPSmpVWklwd05xSFZSK256ZWtyd28wazlFcnlGOUd0OUdKZnpNYTE0TXEvWldOYXVUZmk4Z29kbkduTjk5Y0MzZ09QUzRld1p1UXkxTzg5aElrUW44dE8wQ05Hb2ZKN0FwUmlNMTlTclFDd1JlMDBDMDJSVTZZbEZIcHcwN3NFMlJRPT0iLCJtYWMiOiI5ZmNhMjBmMjcwNzI2YmNjODlmZTlmNjgzMTNhNDQ2ODBmY2VjZTQ3YjNjMjRiYThiY2YyMDVhODJiNDk5Yzg3IiwidGFnIjoiIn0%3D',
    'photoIds': 'eyJpdiI6IjAyZzRLRC9SbmQ1TUplZ2tqalBHOWc9PSIsInZhbHVlIjoibWRSVi9hdk8yTFA2OW5tOFhYZGdIaEwxS0RtSnJwNXZ0Nkk0eUM1bnpxL0g3akJXalVLQllQS1NOdzIxeURkcmJMWVZVWDY5SGdQRlZLLzJjdldXSS80cFZ5b1R1MHB2bmxvd1poS1l2N2Ficzd1OTdtSklvcEVGcXhhbnJ1YnlBaUVucExWUzJ1UEhKMmpLbHJvemZFaHRKUG41aktVZDU0VGFRelU4Y0JYaHRnMFRkWDZJd2gyNWhUQ1hmVzVuc1pFMW90elZnaGtZY1graE1RTEcxdnN0VXAxNjU4Z2NTajVCK25SQzdZVWdjNGJQSGJLOFoyYkVkbEF4MUdKQSIsIm1hYyI6IjM5ZjA0ZGQ0NTk3ZGJiMDZlNTI4ZmZiNzY3YzEzNjUzNmI5MGM5Mzc1Njk3ZmVhMGYwYWI5OTJlNTQyYzdhNjkiLCJ0YWciOiIifQ%3D%3D',
    '_ga_1CSGBFDC5W': 'GS1.1.1705462808.58.1.1705462846.0.0.0',
    '_ga_S43JVJMFSJ': 'GS1.1.1705462808.47.1.1705462847.0.0.0',
    'prefs': '%5BcommentSort%7Coldest%5D%5BmapX%7C-11839453%5D%5BmapY%7C4172727%5D%5BmapZoom%7C12.2%5D',
    'XSRF-TOKEN': 'eyJpdiI6Ilk3b0dlK3pPVE94UFJ1Skg0NWd3V0E9PSIsInZhbHVlIjoiYWpDMGt2czJxU0tjTEU1eklieG55UWp5NGg2MUtrNklNVlRVQlQ5cDZKVEdWdDdvNnFoMEhQZVJOZjlpZFRldFZoOXdpdjNzVzc2MDJLdW9qZVNsV21jZHMrOEFJZFg5RGV4V01ZRkVrd2x0OEE0Qm9iTHUyQWRqOTh6dGJFaDEiLCJtYWMiOiI2NjY1NGMzZTM3ZmFlNTkwYzI5ZDA5NGMzYjQxZWJiOWVhMTcwNjA2ZWMxYjBjMzBlNGI4ZTFmNTI1NzhmZmJlIiwidGFnIjoiIn0%3D',
    'ap_session': 'eyJpdiI6IlliU0xaUnVhelNIMFQ2WXFncXMwSVE9PSIsInZhbHVlIjoiazRPazVrMzNPSVByTVdhWTV3Qytpa21CM0trV1ZleEZqMEE5R2loS1hMZDZzY2FNZEF2M3FMdWh2UnhUbXFQbCtKMVVhKzFML1hFOUhjWTE3NyswR2J4eVV6bXlTM2s1Rjg2ZEZNb2w2WlEzRWlqKzhLSkREWGtGLzd2dUdpVDIiLCJtYWMiOiI2N2Q3OTBiNjY1MTE3ODUyZTgwNTBkOTgxM2U0ZDRlNmMwZWNlMWU1ZDlkMjJiOWViNWM2NzQ0M2U2MGMxMmIyIiwidGFnIjoiIn0%3D',
    'pageCount': 'eyJpdiI6IlFNTHd5NVFpb2xLRkR3UncvdkllaVE9PSIsInZhbHVlIjoiN1JZYVNzKzI0MS9tTzg0a3JRWWoyYkZ3Y1ZlcDBvek5PMko2UExPdnpoSlJydzFXeFVLenVXeWJvU3I0cHE0ayIsIm1hYyI6IjNiOTljZWNhZTFjYzQ2ZDFkYzg3YTU2N2FiYjE4OGIzMzBjNTVjZTZhOWRmYmE0NmQ2NzcwOGFhYmEzOGI5NWQiLCJ0YWciOiIifQ%3D%3D',
}

headers = {
    'authority': 'www.mtbproject.com',
    'accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7',
    'accept-language': 'en-US,en;q=0.9',
    # 'cookie': 'photosTitle=Nearby%20Photos; _fbp=fb.1.1696091992253.102672014; user=eyJpdiI6InplYTR1SU1LY2ZsUW9IbW0rdmthQkE9PSIsInZhbHVlIjoiNldIbHZFRmw3Y2drNWN5N2NOcDNtKzBoYS8vRFc5dm51S3N4Q0QvQnluN3lxVFBzdmdhU01VcE5FY0xFNVJGcGsybE1HcGJ6TmNLTE54VEwwM05qMVQ4SWxIVzA2NHgvTWZKRFJnMlF1SHVCb2owUnZodEFPTkxXTGdOSWowYWZMTmVvSnBZd1ZMNGNPOTRhYXhHNy92WnJUYkcxMit0WmhpSXFrcDZBUnBnPSIsIm1hYyI6ImUwMDk3MWZlNDk3ZDE3ODRmZTM3MDhjNzJiMjcxMzJmMGJkNzUwOTQwYTJmYjg5OGFmNDdkYzg2NDFmZWJmOWMiLCJ0YWciOiIifQ%3D%3D; ids=eyJpdiI6Im9mbGxHaVJla3lNdlRmaEkwV3lEeGc9PSIsInZhbHVlIjoiVnU3VVY3REhFd0xXVkp1NG9lRTVSQU9xLy9oeVRpNWZENkh3aHFBWjZhY1IzOFZ5aDhyeDRmWWM0RVlLSVZUdVhpSHAvUEtnMGpad3EzQ00zY3VDMEE9PSIsIm1hYyI6ImY1NDc2Y2I2MmQ2MDVmZGVhMmQ2MmNjOWM0OGE3ODEyMTE0Nzk4OGQ4OWU0NzRiZGIwMzQ5YTRhZmIzYjFjMWEiLCJ0YWciOiIifQ%3D%3D; _ga_ZT4D3MZ8J2=GS1.1.1698606563.14.1.1698606583.0.0.0; GCLB=CJKU7bj9rvOGQw; _ga=GA1.1.850084306.1696091991; savedReferrer=eyJpdiI6IjlOdldXTHNhMVA5amdSb25wUi9ZMEE9PSIsInZhbHVlIjoiRCtxSzFoZS92QkhXTDU1dHFMRDZPSmpVWklwd05xSFZSK256ZWtyd28wazlFcnlGOUd0OUdKZnpNYTE0TXEvWldOYXVUZmk4Z29kbkduTjk5Y0MzZ09QUzRld1p1UXkxTzg5aElrUW44dE8wQ05Hb2ZKN0FwUmlNMTlTclFDd1JlMDBDMDJSVTZZbEZIcHcwN3NFMlJRPT0iLCJtYWMiOiI5ZmNhMjBmMjcwNzI2YmNjODlmZTlmNjgzMTNhNDQ2ODBmY2VjZTQ3YjNjMjRiYThiY2YyMDVhODJiNDk5Yzg3IiwidGFnIjoiIn0%3D; photoIds=eyJpdiI6IjAyZzRLRC9SbmQ1TUplZ2tqalBHOWc9PSIsInZhbHVlIjoibWRSVi9hdk8yTFA2OW5tOFhYZGdIaEwxS0RtSnJwNXZ0Nkk0eUM1bnpxL0g3akJXalVLQllQS1NOdzIxeURkcmJMWVZVWDY5SGdQRlZLLzJjdldXSS80cFZ5b1R1MHB2bmxvd1poS1l2N2Ficzd1OTdtSklvcEVGcXhhbnJ1YnlBaUVucExWUzJ1UEhKMmpLbHJvemZFaHRKUG41aktVZDU0VGFRelU4Y0JYaHRnMFRkWDZJd2gyNWhUQ1hmVzVuc1pFMW90elZnaGtZY1graE1RTEcxdnN0VXAxNjU4Z2NTajVCK25SQzdZVWdjNGJQSGJLOFoyYkVkbEF4MUdKQSIsIm1hYyI6IjM5ZjA0ZGQ0NTk3ZGJiMDZlNTI4ZmZiNzY3YzEzNjUzNmI5MGM5Mzc1Njk3ZmVhMGYwYWI5OTJlNTQyYzdhNjkiLCJ0YWciOiIifQ%3D%3D; _ga_1CSGBFDC5W=GS1.1.1705462808.58.1.1705462846.0.0.0; _ga_S43JVJMFSJ=GS1.1.1705462808.47.1.1705462847.0.0.0; prefs=%5BcommentSort%7Coldest%5D%5BmapX%7C-11839453%5D%5BmapY%7C4172727%5D%5BmapZoom%7C12.2%5D; XSRF-TOKEN=eyJpdiI6Ilk3b0dlK3pPVE94UFJ1Skg0NWd3V0E9PSIsInZhbHVlIjoiYWpDMGt2czJxU0tjTEU1eklieG55UWp5NGg2MUtrNklNVlRVQlQ5cDZKVEdWdDdvNnFoMEhQZVJOZjlpZFRldFZoOXdpdjNzVzc2MDJLdW9qZVNsV21jZHMrOEFJZFg5RGV4V01ZRkVrd2x0OEE0Qm9iTHUyQWRqOTh6dGJFaDEiLCJtYWMiOiI2NjY1NGMzZTM3ZmFlNTkwYzI5ZDA5NGMzYjQxZWJiOWVhMTcwNjA2ZWMxYjBjMzBlNGI4ZTFmNTI1NzhmZmJlIiwidGFnIjoiIn0%3D; ap_session=eyJpdiI6IlliU0xaUnVhelNIMFQ2WXFncXMwSVE9PSIsInZhbHVlIjoiazRPazVrMzNPSVByTVdhWTV3Qytpa21CM0trV1ZleEZqMEE5R2loS1hMZDZzY2FNZEF2M3FMdWh2UnhUbXFQbCtKMVVhKzFML1hFOUhjWTE3NyswR2J4eVV6bXlTM2s1Rjg2ZEZNb2w2WlEzRWlqKzhLSkREWGtGLzd2dUdpVDIiLCJtYWMiOiI2N2Q3OTBiNjY1MTE3ODUyZTgwNTBkOTgxM2U0ZDRlNmMwZWNlMWU1ZDlkMjJiOWViNWM2NzQ0M2U2MGMxMmIyIiwidGFnIjoiIn0%3D; pageCount=eyJpdiI6IlFNTHd5NVFpb2xLRkR3UncvdkllaVE9PSIsInZhbHVlIjoiN1JZYVNzKzI0MS9tTzg0a3JRWWoyYkZ3Y1ZlcDBvek5PMko2UExPdnpoSlJydzFXeFVLenVXeWJvU3I0cHE0ayIsIm1hYyI6IjNiOTljZWNhZTFjYzQ2ZDFkYzg3YTU2N2FiYjE4OGIzMzBjNTVjZTZhOWRmYmE0NmQ2NzcwOGFhYmEzOGI5NWQiLCJ0YWciOiIifQ%3D%3D',
    'referer': referer, 
    'sec-ch-ua': '"Google Chrome";v="117", "Not;A=Brand";v="8", "Chromium";v="117"',
    'sec-ch-ua-mobile': '?0',
    'sec-ch-ua-platform': '"Linux"',
    'sec-fetch-dest': 'document',
    'sec-fetch-mode': 'navigate',
    'sec-fetch-site': 'same-origin',
    'sec-fetch-user': '?1',
    'upgrade-insecure-requests': '1',
    'user-agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.0.0 Safari/537.36',
}

with requests.get(gpx_url, cookies=cookies, headers=headers) as r:
    with open(gpx_file, 'wb') as f:
        for chunk in r.iter_content(chunk_size):
            if chunk:
                f.write(chunk)

